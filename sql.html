<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SQL Toolkit</title>
    <link rel="stylesheet" href="./css/sql.css" />
    <link rel="stylesheet" href="./css/base/date_picker.css" />
    <script defer src="./js/base/common.js"></script>
    <script defer src="./js/base/local_storage.js"></script>
    <script defer src="./js/base/date_picker.js"></script>
    <script defer src="./js/sql.js"></script>
  </head>
  <body>

    <!-- ページヘッダー -->
    <header class="page-header">
      <div class="page-header__inner">
        <div class="page-header__brand">
          <svg class="page-header__icon" viewBox="0 0 16 16" aria-hidden="true">
            <path d="M1 3.5c0-.626.292-1.165.7-1.59.406-.422.956-.767 1.579-1.041C4.525.32 6.195 0 8 0c1.805 0 3.475.32 4.722.869.622.274 1.172.62 1.578 1.04.408.426.7.965.7 1.591v9c0 .626-.292 1.165-.7 1.59-.406.422-.956.767-1.579 1.041C11.476 15.68 9.806 16 8 16c-1.805 0-3.475-.32-4.721-.869-.623-.274-1.173-.62-1.579-1.04-.408-.426-.7-.965-.7-1.591Zm1.5 0c0 .133.065.318.258.52.192.202.52.41.98.602C4.7 5.07 6.231 5.5 8 5.5c1.769 0 3.3-.43 4.26-.878.463-.192.79-.4.982-.602.193-.202.258-.387.258-.52 0-.133-.065-.318-.258-.52-.192-.202-.52-.41-.98-.602C11.3 1.93 9.769 1.5 8 1.5c-1.769 0-3.3.43-4.26.878-.463.192-.79.4-.982.602-.193.202-.258.387-.258.52Zm0 4.5c0 .133.065.318.26.52.19.202.52.41.979.602C4.7 9.57 6.231 10 8 10c1.769 0 3.3-.43 4.26-.878.463-.192.79-.4.982-.602.194-.202.258-.387.258-.52V5.724c-.17.1-.353.193-.55.28C11.475 6.68 9.805 7 8 7c-1.805 0-3.475-.32-4.721-.869a6.15 6.15 0 0 1-.55-.281Zm0 2.225V12.5c0 .133.065.318.26.52.19.202.52.41.979.602C4.7 14.07 6.231 14.5 8 14.5c1.769 0 3.3-.43 4.26-.878.463-.192.79-.4.982-.602.194-.202.258-.387.258-.52v-2.275c-.17.1-.353.193-.55.28C11.475 11.18 9.805 11.5 8 11.5c-1.805 0-3.475-.32-4.721-.869a6.15 6.15 0 0 1-.55-.281Z"/>
          </svg>
          <h1 class="page-header__title">SQL Toolkit</h1>
        </div>
        <p class="page-header__desc">Oracle SQL*Plus 接続・実行計画・チューニング支援ツール</p>
      </div>
    </header>

    <main class="page-main">

      <!-- チューニング対象 -->
      <section class="card">
        <details class="tune-details" id="tune-details" open>
          <summary class="card__header tune-details__summary">
            <div class="card__title">
              <svg viewBox="0 0 16 16" aria-hidden="true"><path d="M8.22 1.754a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-.25-5.25a.75.75 0 0 0-1.5 0v2.5a.75.75 0 0 0 1.5 0Z"/></svg>
              チューニング対象
            </div>
            <svg class="tune-details__chevron" viewBox="0 0 16 16" aria-hidden="true"><path d="M12.78 5.22a.749.749 0 0 1 0 1.06l-4.25 4.25a.749.749 0 0 1-1.06 0L3.22 6.28a.749.749 0 1 1 1.06-1.06L8 8.939l3.72-3.719a.749.749 0 0 1 1.06 0Z"/></svg>
          </summary>
          <div class="tune-grid" id="tune-grid"></div>
        </details>
      </section>

      <!-- SQL*Plus 接続 -->
      <section class="card">
        <div class="card__header">
          <div class="card__title">
            <svg viewBox="0 0 16 16" aria-hidden="true"><path d="M0 2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25Zm1.75-.25a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V2.75a.25.25 0 0 0-.25-.25ZM7.25 8a.75.75 0 0 1-.22.53l-2.25 2.25a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L5.44 8 3.72 6.28a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215l2.25 2.25c.141.14.22.331.22.53Zm1.5 1.5h3a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5Z"/></svg>
            SQL*Plus 接続
          </div>
        </div>
        <div class="card__body">
          <!-- 接続先環境 -->
          <div class="form-row">
            <label class="form-label">接続先</label>
            <group id="env" class="seg-ctrl"></group>
          </div>

          <!-- 接続環境管理（折りたたみ） -->
          <details class="env-manager" id="env-manager">
            <summary class="env-manager__summary">
              <svg viewBox="0 0 16 16" aria-hidden="true"><path d="M8 0a8.2 8.2 0 0 1 .701.031C9.444.095 9.99.645 9.99 1.4v.94c0 .708.43 1.27 1.07 1.592.245.12.497.24.749.357.66.303 1.391.101 1.87-.39l.663-.665a1.4 1.4 0 0 1 1.981 0l.754.754a1.4 1.4 0 0 1 0 1.981l-.665.664c-.49.479-.692 1.21-.389 1.87.117.252.237.504.357.749.322.64.884 1.07 1.592 1.07h.94c.755 0 1.305.546 1.369 1.289A8.2 8.2 0 0 1 16 8c0 .239-.012.476-.031.701-.064.743-.614 1.289-1.369 1.289h-.94c-.708 0-1.27.43-1.592 1.07a11.372 11.372 0 0 1-.357.749c-.303.66-.101 1.391.39 1.87l.665.663a1.4 1.4 0 0 1 0 1.981l-.754.754a1.4 1.4 0 0 1-1.981 0l-.664-.665c-.479-.49-1.21-.692-1.87-.389a11.372 11.372 0 0 1-.749.357C8.67 15.57 8.108 16 7.4 16h-.94c-.755 0-1.305-.546-1.369-1.289A8.2 8.2 0 0 1 0 8c0-.239.012-.476.031-.701C.095 6.556.645 6.01 1.4 6.01h.94c.708 0 1.27-.43 1.592-1.07.12-.245.24-.497.357-.749.303-.66.101-1.391-.39-1.87l-.663-.663a1.4 1.4 0 0 1 0-1.981l.754-.754a1.4 1.4 0 0 1 1.981 0l.665.664c.479.49 1.21.692 1.87.389.252-.117.504-.237.749-.357C6.73.43 7.16 0 7.868 0H8Zm0 6.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Z"/></svg>
              接続環境を管理
              <svg class="env-manager__chevron" viewBox="0 0 16 16" aria-hidden="true"><path d="M12.78 5.22a.749.749 0 0 1 0 1.06l-4.25 4.25a.749.749 0 0 1-1.06 0L3.22 6.28a.749.749 0 1 1 1.06-1.06L8 8.939l3.72-3.719a.749.749 0 0 1 1.06 0Z"/></svg>
            </summary>
            <div class="env-manager__body">
              <!-- 環境一覧 -->
              <div id="env-list" class="env-list"></div>
              <!-- 追加フォーム -->
              <form id="env-form" class="env-form" autocomplete="off">
                <div class="env-form__grid">
                  <input type="text"     id="env-key"     class="form-input form-input--sm" placeholder="環境名 (例: PROD)" autocomplete="off" required />
                  <input type="text"     id="env-user"    class="form-input form-input--sm" placeholder="ユーザー名 (例: SCOTT)" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" pattern="[A-Za-z][A-Za-z0-9_$#]*" required />
                  <input type="password" id="env-pass"    class="form-input form-input--sm" placeholder="パスワード" autocomplete="new-password" />
                  <input type="text"     id="env-host"    class="form-input form-input--sm" placeholder="ホスト名または IP" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" inputmode="url" pattern="[A-Za-z0-9][A-Za-z0-9._\-]*" required />
                  <input type="text"     id="env-port"    class="form-input form-input--sm" placeholder="ポート (省略時: 1521)" autocomplete="off" autocorrect="off" autocapitalize="none" inputmode="numeric" pattern="[0-9]{1,5}" />
                  <input type="text"     id="env-service" class="form-input form-input--sm" placeholder="サービス名 (例: ORCL)" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" inputmode="url" pattern="[A-Za-z0-9][A-Za-z0-9._]*" required />
                </div>
                <button type="submit" class="btn btn--secondary btn--sm">
                  <svg viewBox="0 0 16 16" aria-hidden="true"><path d="M7.75 2a.75.75 0 0 1 .75.75V7h4.25a.75.75 0 0 1 0 1.5H8.5v4.25a.75.75 0 0 1-1.5 0V8.5H2.75a.75.75 0 0 1 0-1.5H7V2.75A.75.75 0 0 1 7.75 2Z"/></svg>
                  追加
                </button>
              </form>
              <!-- エクスポート / インポート -->
              <div class="env-io">
                <button id="env-export" class="btn btn--secondary btn--sm">
                  <svg viewBox="0 0 16 16" aria-hidden="true"><path d="M2.75 14A1.75 1.75 0 0 1 1 12.25v-2.5a.75.75 0 0 1 1.5 0v2.5c0 .138.112.25.25.25h10.5a.25.25 0 0 0 .25-.25v-2.5a.75.75 0 0 1 1.5 0v2.5A1.75 1.75 0 0 1 13.25 14Zm-1-5.573 3.25 3.25a.749.749 0 0 0 1.06 0l3.25-3.25a.749.749 0 1 0-1.06-1.06L8 11.19 6.75 9.94 5.81 9H7V2.75a.75.75 0 0 0-1.5 0V9H3.81l-.94.94L1.81 11.19 3.31 9.69a.749.749 0 1 0-1.06 1.06Z"/></svg>
                  JSONエクスポート
                </button>
                <label class="btn btn--secondary btn--sm" for="env-import-file">
                  <svg viewBox="0 0 16 16" aria-hidden="true"><path d="M2.75 14A1.75 1.75 0 0 1 1 12.25v-2.5a.75.75 0 0 1 1.5 0v2.5c0 .138.112.25.25.25h10.5a.25.25 0 0 0 .25-.25v-2.5a.75.75 0 0 1 1.5 0v2.5A1.75 1.75 0 0 1 13.25 14ZM11.25 1.75 8 5 4.75 1.75a.749.749 0 1 0-1.06 1.06l3.72 3.72a.749.749 0 0 0 1.06 0l3.72-3.72a.749.749 0 1 0-1.06-1.06Z"/></svg>
                  JSONインポート
                </label>
                <input type="file" id="env-import-file" accept=".json" class="sr-only" />
              </div>
            </div>
          </details>

          <!-- 起動オプション -->
          <div class="form-row">
            <label class="form-label">起動オプション</label>
            <div class="option-checks" id="sqlplus-options"></div>
          </div>
          <!-- 追加パラメータ -->
          <div class="form-row">
            <label class="form-label" for="sqlplus-extra">追加パラメータ</label>
            <input type="text" id="sqlplus-extra" class="form-input"
              placeholder="例: @start.sql  /NOLOG  -R 1" />
          </div>
          <!-- コマンドプレビュー -->
          <div class="cmd-preview-wrap">
            <span class="cmd-preview-label">プレビュー</span>
            <pre class="cmd-preview" id="conn-preview"></pre>
          </div>
          <!-- コピーボタン -->
          <div class="action-row">
            <button id="conn" class="btn btn--primary">
              <svg viewBox="0 0 16 16" aria-hidden="true"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/></svg>
              接続コマンドをコピー
            </button>
          </div>
        </div>
      </section>

      <!-- セッション設定 -->
      <section class="card">
        <div class="card__header">
          <div class="card__title">
            <svg viewBox="0 0 16 16" aria-hidden="true"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"/></svg>
            セッション設定
          </div>
        </div>
        <div class="card__body">
          <p class="form-hint">実行前に SQL*Plus で貼り付けて実行してください。</p>
          <div class="btn-row">
            <button class="btn btn--secondary copy"
              data-copy="SET LINESIZE 300&#13;&#10;SET PAGESIZE 0&#13;&#10;SET FEEDBACK ON&#13;&#10;SET TIMING ON&#13;&#10;SET TRIMSPOOL ON&#13;&#10;COL plan_plus_exp FORMAT A300&#13;&#10;SET AUTOTRACE TRACEONLY">
              <svg viewBox="0 0 16 16" aria-hidden="true"><path d="M1.75 1h8.5c.966 0 1.75.784 1.75 1.75v5.5A1.75 1.75 0 0 1 10.25 10H7.061l-2.574 2.573A1.458 1.458 0 0 1 2 11.543V10h-.25A1.75 1.75 0 0 1 0 8.25v-5.5C0 1.784.784 1 1.75 1ZM1.5 2.75v5.5c0 .138.112.25.25.25h1a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h3.5a.25.25 0 0 0 .25-.25v-5.5a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13 2a.25.25 0 0 0-.25-.25h-.5a.75.75 0 0 1 0-1.5h.5c.966 0 1.75.784 1.75 1.75v5.5A1.75 1.75 0 0 1 14.25 12H14v1.543a1.458 1.458 0 0 1-2.487 1.03L9.22 12.28a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215l2.22 2.22v-2.19a.75.75 0 0 1 .75-.75h1a.25.25 0 0 0 .25-.25Z"/></svg>
              実行計画
            </button>
            <button class="btn btn--secondary copy"
              data-copy="SET LINESIZE 300&#13;&#10;SET PAGESIZE 50000&#13;&#10;SET FEEDBACK ON&#13;&#10;SET TIMING ON&#13;&#10;SET TRIMSPOOL ON&#13;&#10;SET AUTOTRACE OFF">
              <svg viewBox="0 0 16 16" aria-hidden="true"><path d="M1.75 1h8.5c.966 0 1.75.784 1.75 1.75v5.5A1.75 1.75 0 0 1 10.25 10H7.061l-2.574 2.573A1.458 1.458 0 0 1 2 11.543V10h-.25A1.75 1.75 0 0 1 0 8.25v-5.5C0 1.784.784 1 1.75 1ZM1.5 2.75v5.5c0 .138.112.25.25.25h1a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h3.5a.25.25 0 0 0 .25-.25v-5.5a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13 2a.25.25 0 0 0-.25-.25h-.5a.75.75 0 0 1 0-1.5h.5c.966 0 1.75.784 1.75 1.75v5.5A1.75 1.75 0 0 1 14.25 12H14v1.543a1.458 1.458 0 0 1-2.487 1.03L9.22 12.28a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215l2.22 2.22v-2.19a.75.75 0 0 1 .75-.75h1a.25.25 0 0 0 .25-.25Z"/></svg>
              実行結果
            </button>
          </div>
          <!-- コマンド内容プレビュー（ホバー表示） -->
          <details class="cmd-detail">
            <summary class="cmd-detail__summary">コマンド内容を確認</summary>
            <div class="cmd-detail__grid">
              <div>
                <p class="cmd-detail__label">実行計画</p>
                <pre class="cmd-preview cmd-preview--sm">SET LINESIZE 300
SET PAGESIZE 0
SET FEEDBACK ON
SET TIMING ON
SET TRIMSPOOL ON
COL plan_plus_exp FORMAT A300
SET AUTOTRACE TRACEONLY</pre>
              </div>
              <div>
                <p class="cmd-detail__label">実行結果</p>
                <pre class="cmd-preview cmd-preview--sm">SET LINESIZE 300
SET PAGESIZE 50000
SET FEEDBACK ON
SET TIMING ON
SET TRIMSPOOL ON
SET AUTOTRACE OFF</pre>
              </div>
            </div>
          </details>
        </div>
      </section>

      <!-- バインド変数 -->
      <section class="card">
        <div class="card__header">
          <div class="card__title">
            <svg viewBox="0 0 16 16" aria-hidden="true"><path d="M0 1.75A.75.75 0 0 1 .75 1h4.253c1.227 0 2.317.59 3 1.501A3.743 3.743 0 0 1 11.006 1h4.245a.75.75 0 0 1 .75.75v10.5a.75.75 0 0 1-.75.75h-4.507a2.25 2.25 0 0 0-1.591.659l-.622.621a.75.75 0 0 1-1.06 0l-.622-.621A2.25 2.25 0 0 0 5.258 13H.75a.75.75 0 0 1-.75-.75Zm7.251 10.324.004-5.073-.002-2.253A2.25 2.25 0 0 0 5.003 2.5H1.5v9h3.757a3.75 3.75 0 0 1 1.994.574ZM8.755 4.75l-.004 7.322a3.752 3.752 0 0 1 1.992-.572H14.5v-9h-3.495a2.25 2.25 0 0 0-2.25 2.25Z"/></svg>
            バインド変数
          </div>
          <button id="param-copy" class="btn btn--primary">
            <svg viewBox="0 0 16 16" aria-hidden="true"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/></svg>
            EXEC文をコピー
          </button>
        </div>
        <div class="card__body">
          <p class="form-hint">使用するバインド変数の型と桁数を設定し、EXEC文をコピーしてください。</p>
          <div class="param-table">
            <div class="param-table__head">
              <span>使用</span>
              <span>変数名</span>
              <span>型</span>
              <span>桁数</span>
              <span>値</span>
              <span></span>
            </div>
            <div id="param-wrapper"></div>
          </div>
          <div class="param-add-wrap">
            <button id="param-add" type="button" class="btn btn--secondary btn--sm">
              <svg viewBox="0 0 16 16" aria-hidden="true"><path d="M7.75 2a.75.75 0 0 1 .75.75V7h4.25a.75.75 0 0 1 0 1.5H8.5v4.25a.75.75 0 0 1-1.5 0V8.5H2.75a.75.75 0 0 1 0-1.5H7V2.75A.75.75 0 0 1 7.75 2Z"/></svg>
              行を追加
            </button>
          </div>
        </div>
      </section>

    </main>

    <!-- コピー成功トースト -->
    <div id="copy-toast" class="toast" hidden>コピーしました</div>

    <!-- カスタム日付ピッカー -->
    <div id="date-picker" class="datepicker" hidden>
      <div class="datepicker__backdrop" data-dp-action="cancel"></div>
      <div class="datepicker__dialog">
        <div class="datepicker__quickbtns">
          <button data-dp-action="today">今日</button>
          <button data-dp-action="tomorrow">明日</button>
          <button data-dp-action="month-end">月末</button>
          <button data-dp-action="clear" class="datepicker__btn--danger">クリア</button>
        </div>
        <div class="datepicker__nav">
          <button data-dp-action="prev-year" aria-label="前の年">«</button>
          <button data-dp-action="prev-month" aria-label="前の月">‹</button>
          <span id="dp-month-label"></span>
          <button data-dp-action="next-month" aria-label="次の月">›</button>
          <button data-dp-action="next-year" aria-label="次の年">»</button>
        </div>
        <div id="dp-grid" class="datepicker__grid"></div>
        <div class="datepicker__footer">
          <button data-dp-action="confirm" class="btn btn--sm btn--primary">決定</button>
        </div>
      </div>
    </div>

  </body>
</html>

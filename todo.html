<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TODO</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="./css/todo.css" />
    <script defer src="https://unpkg.com/vue@2.6.12"></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/sortablejs@1.8.4/Sortable.min.js"
    ></script>
    <script
      defer
      src="https://cdnjs.cloudflare.com/ajax/libs/Vue.Draggable/2.20.0/vuedraggable.umd.min.js"
    ></script>
    <script defer src="./js/todo.js"></script>
  </head>
  <body>
    <div id="app">
      <div class="container-fluid">
        <div class="row my-4"></div>
        <div class="row mb-4">
          <div class="col-auto">
            <button class="btn btn-primary" v-on:click="addGroup">
              タスクグループの追加
            </button>
          </div>
        </div>

        <draggable
          class="row flex-nowrap w-100"
          ghost-class="ghost"
          style="overflow: auto"
          @end="saveCurrent"
        >
          <div
            class="col-3 items py-4 m-2 bg-info"
            v-for="(item,index) in tasks"
            :key="'task-' + index"
            v-on:mouseenter="addClass($event)"
            v-on:mouseleave="removeClass($event)"
          >
            <div class="mb-3">
              <input
                type="text"
                class="form-control fw-bold"
                v-model="item.name"
                placeholder="グループ名を入力"
              />

              <div class="text-end mt-2">
                <button
                  class="btn btn-sm btn-outline-danger"
                  v-on:click="delGroup(index)"
                >
                  このタスクグループを削除
                </button>
              </div>
            </div>
            <div class="rounded">
              <div class="p-3">
                <button
                  class="btn w-100 btn-secondary"
                  v-on:click="addTask(item, index)"
                >
                  タスクの追加
                  <span class="badge rounded-pill bg-danger"
                    >{{ item.cnt }}件</span
                  >
                </button>
              </div>
              <draggable
                class="items"
                ghost-class="ghost"
                :list="item.task"
                group="tasks"
                @end="saveCurrent"
              >
                <div
                  class="item p-3 bg-white rounded mb-2"
                  v-for="(item2,index2) in item.task"
                  :key="'item-' + index2"
                  v-on:mouseenter="addClass($event)"
                  v-on:mouseleave="removeClass($event)"
                >
                  <textarea
                    class="form-control"
                    style="height: 100px"
                    v-model="item2.name"
                    placeholder="タスクを入力"
                  ></textarea>
                  <input
                    type="date"
                    class="form-control mt-2 limit-date"
                    v-model="item2.date"
                    v-on:change="changeClassDate($event)"
                  />
                  <div class="text-end mt-2">
                    <button
                      class="btn btn-sm btn-outline-danger"
                      v-on:click="delTask(item.task,index,index2)"
                    >
                      このタスクを削除
                    </button>
                  </div>
                </div>
              </draggable>
            </div>
          </div>
        </draggable>
      </div>
    </div>
  </body>
</html>
